<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="geodimension">
<title>geodimension: Definition of Geographic Dimensions • geodimension</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="geodimension: Definition of Geographic Dimensions">
<meta property="og:description" content="geodimension">
<meta property="og:image" content="https://josesamos.github.io/geodimension/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">geodimension</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/geodimension.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/josesamos/geodimension/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>geodimension: Definition of Geographic Dimensions</h1>
                        <h4 data-toc-skip class="author">Jose Samos (<a href="mailto:jsamos@ugr.es" class="email">jsamos@ugr.es</a>)</h4>
            
            <h4 data-toc-skip class="date">2020-11-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/josesamos/geodimension/blob/HEAD/vignettes/geodimension.Rmd" class="external-link"><code>vignettes/geodimension.Rmd</code></a></small>
      <div class="d-none name"><code>geodimension.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <em>multidimensional data model</em> was defined with the aim of
supporting data analysis. In multidimensional systems, data is
structured in facts and dimensions<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Basic concepts of dimensional modelling and star schemas
are presented in &lt;a href="https://CRAN.R-project.org/package=starschemar" class="external-link"&gt;&lt;code&gt;starschemar&lt;/code&gt;&lt;/a&gt;
vignettes.&lt;/p&gt;'><sup>1</sup></a>. The <em>geographic dimension</em> plays a
fundamental role in multidimensional systems. Apart from the analysis
possibilities it offers, like any other dimension, it is very
interesting to have the possibility of representing the reports obtained
from multidimensional systems, using their geographic dimensions, on a
map, or performing spatial analysis on them. This functionality is
supported by package <a href="https://CRAN.R-project.org/package=geomultistar" class="external-link"><code>geomultistar</code></a>.</p>
<p>To define a geographic dimension in a star schema, we need a table
with attributes corresponding to the levels of the dimension.
Additionally, we will also need one or more geographic layers to
represent the data using this dimension. We can obtain this data from
available vector layers of geographic information. In simple cases, one
layer is enough; but we often need several layers related to each other.
The relationships can be defined by common attribute values or can be
inferred from the respective geographic information.</p>
<p>The main objective of this package is to support the definition of
geographic dimensions from layers of geographic information that can be
used in multidimensional systems. In particular, through package <a href="https://cran.r-project.org/package=geomultistar" class="external-link"><code>geomultistar</code></a>
they can be used directly.</p>
<p>The rest of this document is structured as follows: First, an
illustrative example of how the package works is developed. Then, the
document ends with conclusions.</p>
</div>
<div class="section level2">
<h2 id="an-illustrative-example">An illustrative example<a class="anchor" aria-label="anchor" href="#an-illustrative-example"></a>
</h2>
<p>Suppose we have a multidimensional design on US data and the
geographic dimension is defined at the <em>city</em> level. For each
city we have its name and the code of the state in which it is located.
It would be interesting to have other levels of detail in this dimension
to be able to perform roll-up operations.</p>
<p>With this objective, we look for layers of geographic information. In
<a href="https://www.census.gov" class="external-link">United States Census Bureau</a> we find
layers at various levels of detail, including <em>place</em>,
<em>county</em>, <em>state</em>, <em>region</em>, <em>division</em> and
<em>nation</em>. We have obtained them (for <em>place</em> we have
selected only the cities) and we have stored<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;To take up less space in the package, its geometry has
also been simplified.&lt;/p&gt;"><sup>2</sup></a> them in
<code>layer_us_city</code>, <code>layer_us_county</code>,
<code>layer_us_state</code>, <code>layer_us_region</code>,
<code>layer_us_division</code> and <code>layer_us_nation</code>,
respectively.</p>
<p>The layers are related to each other. In some cases they have
attributes in common, in others, although there is a relationship, it is
not explicitly defined. We can use <code>geodimension</code> to support
the definition of these relationships. Once defined, it will also offer
us support to exploit them and obtain information from them.</p>
<p>Thus, three phases can be distinguished:</p>
<ul>
<li><p>Definition of levels.</p></li>
<li><p>Definition of relationships.</p></li>
<li><p>Obtaining information.</p></li>
</ul>
<div class="section level3">
<h3 id="definition-of-levels">Definition of levels<a class="anchor" aria-label="anchor" href="#definition-of-levels"></a>
</h3>
<p>Each of the layers that we have obtained represents a conceptual
level of the geographical dimension, in the package it is called
<code>geolevel</code>. To define a <code>geolevel</code>, we need a
layer and the set of attributes that make up the layer’s key (which
uniquely identify each of its instances).</p>
<p>We can previously check if a set of attributes form a key of the
layer using the <code>check_key</code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://josesamos.github.io/geodimension/">geodimension</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">layer_us_city</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "statefp"      "placefp"      "placens"      "geoid"        "name"        </span></span>
<span><span class="co">#&gt;  [6] "namelsad"     "lsad"         "classfp"      "pcicbsa"      "pcinecta"    </span></span>
<span><span class="co">#&gt; [11] "mtfcc"        "funcstat"     "aland"        "awater"       "shape_length"</span></span>
<span><span class="co">#&gt; [16] "shape_area"   "geoid_data"   "geometry"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/check_key.html">check_key</a></span><span class="op">(</span><span class="va">layer_us_city</span>, key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"statefp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="fu"><a href="../reference/check_key.html">check_key</a></span><span class="op">(</span><span class="va">layer_us_city</span>, key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geoid"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>We might expect the city name (<code>name</code>) and state code
(<code>statefp</code>) to be sufficient to identify a city, however,
they are not<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;For our example, this is not a problem, just a warning
that we must pay attention when we select the cities, to determine if
any are repeated.&lt;/p&gt;"><sup>3</sup></a>. We check that the <code>geoid</code> field
is a valid key, therefore, it will be the one we use to define the
<code>geolevel</code>.</p>
<p>We can check the geometry that is considered for the definition of
the level by means of the <code>get_geometry</code> function (it
simplifies the types into three: <em>point</em>, <em>line</em>, and
<em>polygon</em>). In addition, we give each level a name to be able to
refer to it, as shown below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_geometry.html">get_geometry</a></span><span class="op">(</span><span class="va">layer_us_city</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "point"</span></span>
<span></span>
<span><span class="va">city</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/geolevel.html">geolevel</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"city"</span>,</span>
<span>           layer <span class="op">=</span> <span class="va">layer_us_city</span>,</span>
<span>           key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geoid"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For <code>county</code> it is the same as for <code>city</code>, the
name and the code of the state do not compose a valid key. In this case,
the geometry is polygon. Additionally, a layer with another geometry can
be associated using the <code>add_geometry</code> function or, in the
case of point-type geometry, it can be generated from the polygon layer
using the <code>complete_point_geometry</code> function, as is done
below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_geometry.html">get_geometry</a></span><span class="op">(</span><span class="va">layer_us_county</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "polygon"</span></span>
<span></span>
<span><span class="va">county</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/geolevel.html">geolevel</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>           layer <span class="op">=</span> <span class="va">layer_us_county</span>,</span>
<span>           key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geoid"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/complete_point_geometry.html">complete_point_geometry</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>In the same way, the checks are made and the rest of the levels are
defined. Although all the layers are of the polygon type, we generate
the point layers only for those that we think may be needed.</p>
<p>In some cases, latitude and longitude are stored as fields in the
attribute table, from which we can generate a layer of points using the
<code>coordinates_to_geometry</code> function. We can later associate
that layer to the corresponding level using the
<code>add_geometry</code> function mentioned above.</p>
<p>Below is only the definition of the levels.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">us_state_point</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/coordinates_to_geometry.html">coordinates_to_geometry</a></span><span class="op">(</span><span class="va">layer_us_state</span>,</span>
<span>                          lon_lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"intptlon"</span>, <span class="st">"intptlat"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">state</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/geolevel.html">geolevel</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>           layer <span class="op">=</span> <span class="va">layer_us_state</span>,</span>
<span>           key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"statefp"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_geometry.html">add_geometry</a></span><span class="op">(</span>layer <span class="op">=</span> <span class="va">us_state_point</span><span class="op">)</span></span>
<span></span>
<span><span class="va">region</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/geolevel.html">geolevel</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"region"</span>,</span>
<span>           layer <span class="op">=</span> <span class="va">layer_us_region</span>,</span>
<span>           key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"regionce"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">division</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/geolevel.html">geolevel</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"division"</span>,</span>
<span>           layer <span class="op">=</span> <span class="va">layer_us_division</span>,</span>
<span>           key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"divisionce"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nation</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/geolevel.html">geolevel</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"nation"</span>,</span>
<span>           layer <span class="op">=</span> <span class="va">layer_us_nation</span>,</span>
<span>           key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Once the levels are defined, then we will define the dimension and
the relationships between the levels.</p>
</div>
<div class="section level3">
<h3 id="definition-of-relationships">Definition of relationships<a class="anchor" aria-label="anchor" href="#definition-of-relationships"></a>
</h3>
<p>To define a <code>geodimension</code>, we give it a name and start
from any <code>geolevel</code>. Next, we add the rest of the
<code>geolevels</code> in any order.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gd</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/geodimension.html">geodimension</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"gd_us"</span>,</span>
<span>               level <span class="op">=</span> <span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_level.html">add_level</a></span><span class="op">(</span><span class="va">division</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_level.html">add_level</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_level.html">add_level</a></span><span class="op">(</span><span class="va">nation</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_level.html">add_level</a></span><span class="op">(</span><span class="va">city</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_level.html">add_level</a></span><span class="op">(</span><span class="va">county</span><span class="op">)</span></span></code></pre></div>
<p>Next, we can define the relationships that we want to consider
between the levels. In a relationship there are two parts, the <em>lower
level</em> and the <em>upper level</em>. To define the relationships,
the following points must be taken into account:</p>
<ul>
<li><p>There are no restrictions on the relationships you define, as
long as the relationship can be established.</p></li>
<li><p>It is only necessary to define direct relationships (from them,
indirect ones are derived).</p></li>
<li><p>Relationships can be defined using attributes with common values
between the levels or through geographic relationships between their
instances.</p></li>
<li><p>If we want to reference the upper level through attributes, these
must form a valid key for the level (it does not necessarily have to be
the key that was indicated when defining it, this is used by
default).</p></li>
<li><p>Currently, to define a relationship using geographic properties,
the upper level must be of type polygon.</p></li>
</ul>
<p>The relationships between <em>state</em>, <em>region</em>,
<em>division</em> and <em>nation</em> are defined below.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gd</span> <span class="op">&lt;-</span> <span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/relate_levels.html">relate_levels</a></span><span class="op">(</span>lower_level_name <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>                lower_level_attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"division"</span><span class="op">)</span>,</span>
<span>                upper_level_name <span class="op">=</span> <span class="st">"division"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/relate_levels.html">relate_levels</a></span><span class="op">(</span>lower_level_name <span class="op">=</span> <span class="st">"division"</span>,</span>
<span>                upper_level_name <span class="op">=</span> <span class="st">"region"</span>,</span>
<span>                by_geography <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/relate_levels.html">relate_levels</a></span><span class="op">(</span>lower_level_name <span class="op">=</span> <span class="st">"region"</span>,</span>
<span>                upper_level_name <span class="op">=</span> <span class="st">"nation"</span><span class="op">)</span></span></code></pre></div>
<p>The relationship between <em>state</em> and <em>division</em> is
defined by a <em>state</em> attribute that matches the <em>division</em>
key.</p>
<p>The relationship between <em>division</em> and <em>region</em> is
defined by geographic relationship because they do not have any
attributes in common.</p>
<p>Finally, as <em>nation</em> has only one instance, it relates
directly to all instances of the indicated level (in this case,
<em>region</em>), no additional relationship is required.</p>
<p>In addition to these relationships there is a clear relationship
between <em>city</em> and <em>state</em> and also between
<em>county</em> and <em>state</em>. In both cases it can be defined by
attributes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gd</span> <span class="op">&lt;-</span> <span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/relate_levels.html">relate_levels</a></span><span class="op">(</span>lower_level_name <span class="op">=</span> <span class="st">"city"</span>,</span>
<span>                lower_level_attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"statefp"</span><span class="op">)</span>,</span>
<span>                upper_level_name <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/relate_levels.html">relate_levels</a></span><span class="op">(</span>lower_level_name <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>                lower_level_attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"statefp"</span><span class="op">)</span>,</span>
<span>                upper_level_name <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span></code></pre></div>
<p>The relationship between <em>city</em> and <em>county</em> is a bit
fuzzy (at least for me), it depends on the state, the city and also the
county. In any case, if we are interested in establishing a
relationship, we could define it between <em>city</em> and
<em>state</em> using the geographical properties of the levels, since
county includes polygon-type geometry.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gd</span> <span class="op">&lt;-</span> <span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/relate_levels.html">relate_levels</a></span><span class="op">(</span>lower_level_name <span class="op">=</span> <span class="st">"city"</span>,</span>
<span>                upper_level_name <span class="op">=</span> <span class="st">"county"</span>,</span>
<span>                by_geography <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We can check if all the instances have been related using the
following function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span></span>
<span>  <span class="va">gd</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/get_unrelated_instances.html">get_unrelated_instances</a></span><span class="op">(</span>lower_level_name <span class="op">=</span> <span class="st">"city"</span>,</span>
<span>                                 upper_level_name <span class="op">=</span> <span class="st">"county"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>Since there are no unrelated instances, each city has been linked to
the county whose boundaries contain it.</p>
<p>If we did a similar check for each defined relation, we would observe
that all the instances of the lower levels have been related to those of
the higher levels, except for the following:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span></span>
<span>  <span class="va">gd</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/get_unrelated_instances.html">get_unrelated_instances</a></span><span class="op">(</span>lower_level_name <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>                                 upper_level_name <span class="op">=</span> <span class="st">"division"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>If we look at the content:</p>
<table class="table">
<colgroup>
<col width="5%">
<col width="4%">
<col width="4%">
<col width="5%">
<col width="5%">
<col width="3%">
<col width="4%">
<col width="6%">
<col width="3%">
<col width="3%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="7%">
<col width="7%">
<col width="6%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="center">state_key</th>
<th align="center">statefp</th>
<th align="center">region</th>
<th align="center">division</th>
<th align="center">statens</th>
<th align="center">geoid</th>
<th align="center">stusps</th>
<th align="center">name</th>
<th align="center">lsad</th>
<th align="center">mtfcc</th>
<th align="center">funcstat</th>
<th align="center">aland</th>
<th align="center">awater</th>
<th align="center">intptlat</th>
<th align="center">intptlon</th>
<th align="center">shape_length</th>
<th align="center">shape_area</th>
<th align="center">geoid_data</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">52</td>
<td align="center">72</td>
<td align="center">9</td>
<td align="center">0</td>
<td align="center">01779808</td>
<td align="center">72</td>
<td align="center">PR</td>
<td align="center">Puerto Rico</td>
<td align="center">00</td>
<td align="center">G4000</td>
<td align="center">A</td>
<td align="center">8.869e+09</td>
<td align="center">4.922e+09</td>
<td align="center">+18.2176480</td>
<td align="center">-066.4107992</td>
<td align="center">7.428</td>
<td align="center">1.178</td>
<td align="center">04000US72</td>
</tr></tbody>
</table>
<p>The region or division code does not correspond to any of the
existing ones. If we want to relate all the instances of <em>state</em>
to the <em>nation</em> level, we must define the relationship explicitly
(there are other solutions but we will not consider them here, in any
case they can be generated from this one).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gd</span> <span class="op">&lt;-</span> <span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/relate_levels.html">relate_levels</a></span><span class="op">(</span>lower_level_name <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>                upper_level_name <span class="op">=</span> <span class="st">"nation"</span><span class="op">)</span></span></code></pre></div>
<p>With these operations we have defined a
<code>geodimension</code>.</p>
</div>
<div class="section level3">
<h3 id="obtaining-information">Obtaining information<a class="anchor" aria-label="anchor" href="#obtaining-information"></a>
</h3>
<p>From a <code>geodimension</code> we can obtain information in table
or layer format, to define a geographic dimension in a star schema. We
can also define new versions of the dimension.</p>
<p>We can consult the levels of the <code>geodimension</code> using the
following function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_level_names.html">get_level_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "city"     "county"   "division" "nation"   "region"   "state"</span></span></code></pre></div>
<p>A new geodimension is defined by selecting a subset of levels, which
we want to take into account when obtaining information, or to define
new dimensions.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gds</span> <span class="op">&lt;-</span> <span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/select_levels.html">select_levels</a></span><span class="op">(</span>level_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"state"</span>, <span class="st">"division"</span>, <span class="st">"region"</span>, <span class="st">"nation"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gds</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_level_names.html">get_level_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "division" "nation"   "region"   "state"</span></span></code></pre></div>
<p>From any level of the <code>geodimension</code>, a data table can be
obtained that includes only the data of the level or all the data
inherited from higher levels. For each level you can indicate whether or
not a prefix is added to identify the origin of the fields. By default
it is added, as you can see below.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ld</span> <span class="op">&lt;-</span> <span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_level_data.html">get_level_data</a></span><span class="op">(</span>level_name <span class="op">=</span> <span class="st">"division"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ld</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "division_key" "divisionce"   "affgeoid"     "geoid"        "name"        </span></span>
<span><span class="co">#&gt; [6] "lsad"         "aland"        "awater"</span></span>
<span></span>
<span><span class="va">ld</span> <span class="op">&lt;-</span> <span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_level_data.html">get_level_data</a></span><span class="op">(</span>level_name <span class="op">=</span> <span class="st">"division"</span>,</span>
<span>                 inherited <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ld</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "division_key"      "divisionce"        "affgeoid"         </span></span>
<span><span class="co">#&gt;  [4] "geoid"             "name"              "lsad"             </span></span>
<span><span class="co">#&gt;  [7] "aland"             "awater"            "NATION_nation_key"</span></span>
<span><span class="co">#&gt; [10] "NATION_name"       "NATION_affgeoid"   "NATION_geoid"     </span></span>
<span><span class="co">#&gt; [13] "REGION_region_key" "REGION_regionce"   "REGION_affgeoid"  </span></span>
<span><span class="co">#&gt; [16] "REGION_geoid"      "REGION_name"       "REGION_lsad"      </span></span>
<span><span class="co">#&gt; [19] "REGION_aland"      "REGION_awater"</span></span></code></pre></div>
<p>Previously, if we need it, we can obtain the name of the levels from
which a level will inherit attributes.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_higher_level_names.html">get_higher_level_names</a></span><span class="op">(</span>level_name <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>                         indirect_levels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "division" "nation"   "region"</span></span>
<span></span>
<span><span class="va">ld</span> <span class="op">&lt;-</span> <span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_level_data.html">get_level_data</a></span><span class="op">(</span>level_name <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>                 inherited <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ld</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "state_key"             "statefp"               "region"               </span></span>
<span><span class="co">#&gt;  [4] "division"              "statens"               "geoid"                </span></span>
<span><span class="co">#&gt;  [7] "stusps"                "name"                  "lsad"                 </span></span>
<span><span class="co">#&gt; [10] "mtfcc"                 "funcstat"              "aland"                </span></span>
<span><span class="co">#&gt; [13] "awater"                "intptlat"              "intptlon"             </span></span>
<span><span class="co">#&gt; [16] "shape_length"          "shape_area"            "geoid_data"           </span></span>
<span><span class="co">#&gt; [19] "DIVISION_division_key" "DIVISION_divisionce"   "DIVISION_affgeoid"    </span></span>
<span><span class="co">#&gt; [22] "DIVISION_geoid"        "DIVISION_name"         "DIVISION_lsad"        </span></span>
<span><span class="co">#&gt; [25] "DIVISION_aland"        "DIVISION_awater"       "NATION_nation_key"    </span></span>
<span><span class="co">#&gt; [28] "NATION_name"           "NATION_affgeoid"       "NATION_geoid"         </span></span>
<span><span class="co">#&gt; [31] "REGION_region_key"     "REGION_regionce"       "REGION_affgeoid"      </span></span>
<span><span class="co">#&gt; [34] "REGION_geoid"          "REGION_name"           "REGION_lsad"          </span></span>
<span><span class="co">#&gt; [37] "REGION_aland"          "REGION_awater"</span></span></code></pre></div>
<p>For a level we can obtain the available geometries and a layer with
the attribute configuration we want and the selected geometry.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_level_geometries.html">get_level_geometries</a></span><span class="op">(</span>level_name <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "point"   "polygon"</span></span>
<span></span>
<span><span class="va">ll</span> <span class="op">&lt;-</span> <span class="va">gd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/get_level_layer.html">get_level_layer</a></span><span class="op">(</span>level_name <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>                  geometry <span class="op">=</span> <span class="st">"polygon"</span>,</span>
<span>                  only_key <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ll</span><span class="op">)</span></span></code></pre></div>
<p><img src="geodimension_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>In addition to these functions, the package offers the possibility to
change the CRS of all the layers of a geodimension using the
<code>transform_crs</code> function.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>The geographic dimension is very relevant for multidimensional
systems. We can enrich a basic geographic dimension through information
available in vector layers, generally, we will need several layers.</p>
<p>Relationships between layers can be established through attributes or
through the geographic relationships between their instances. The
definition of these relationships can be systematized and is in part
what is intended in this package.</p>
<p>Additionally, once a <code>geodimension</code> has been defined, with
the support of this package, we can easily obtain the attribute table
with all the attributes of the levels that we want (if we need it), and
also the layers with associated geographic information.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jose Samos.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
